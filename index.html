<!DOCTYPE html>
     <html lang="en">
     <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <title>Dorm Debt Wall of Shame</title>
       <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
       <style>
         body {
           font-family: 'Montserrat', sans-serif;
           background: linear-gradient(135deg, #1A1A1A 0%, #2C2C2C 100%);
           color: #FFD700;
           text-align: center;
           padding: 20px;
           margin: 0;
         }
         h1 {
           font-size: 3em;
           font-weight: 700;
           text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
           margin-bottom: 20px;
         }
         .form-container {
           margin: 20px auto;
           background: rgba(255, 255, 255, 0.95);
           padding: 20px;
           border-radius: 15px;
           max-width: 700px;
           box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
         }
         h2 {
           color: #1A1A1A;
           font-size: 1.5em;
           margin-bottom: 10px;
         }
         iframe {
           width: 100%;
           max-width: 640px;
           height: 715px;
           border: none;
         }
         table {
           width: 80%;
           margin: 20px auto;
           border-collapse: collapse;
           background: #FFFFFF;
           color: #1A1A1A;
           border-radius: 10px;
           overflow: hidden;
           box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
         }
         th, td {
           border: 1px solid #FFD700;
           padding: 12px;
           text-align: left;
         }
         th {
           background: #FFD700;
           color: #1A1A1A;
           font-weight: 700;
         }
         td {
           transition: background 0.3s;
         }
         td:hover {
           background: rgba(255, 215, 0, 0.1);
         }
         .overdue {
           color: #FF4444;
           font-weight: bold;
         }
         .paid {
           color: #2ECC71;
           font-weight: bold;
         }
         .total {
           font-size: 1.8em;
           margin: 20px;
           text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
         }
         button {
           background: #FFD700;
           color: #1A1A1A;
           border: none;
           padding: 5px 10px;
           border-radius: 5px;
           cursor: pointer;
           font-size: 0.9em;
         }
         button:hover {
           background: #CCAC00;
         }
         .sign-in {
           background: #FF4444;
           padding: 10px 20px;
           margin: 10px;
         }
         .sign-in:hover {
           background: #CC0000;
         }
       </style>
     </head>
     <body>
       <h1>Dorm Debt Wall of Shame ðŸ’¸</h1>
       <div class="form-container">
         <h2>Record a Debt</h2>
         <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSdkFTlZFZg-hC1imN0YMwhiBUrZKiJUeDmA8v8xkf4mgLKz2Q/viewform?embedded=true" width="640" height="715" frameborder="0" marginheight="0" marginwidth="0">Loadingâ€¦</iframe>
       </div>
       <button class="sign-in" onclick="handleAuthClick()">Sign in to Update Status</button>
       <table id="debtTable">
         <tr><th>Who</th><th>Date</th><th>Amount</th><th>Status</th><th>Action</th></tr>
       </table>
       <div class="total">Total Outstanding: $<span id="total">0.00</span></div>
       <script src="https://apis.google.com/js/api.js"></script>
       <script src="config.js"></script>
       <script>
         let authToken = null;
         const CLIENT_ID = config.CLIENT_ID;
         const SCOPE = 'https://www.googleapis.com/auth/spreadsheets';

         function initClient() {
           gapi.load('client:auth2', () => {
             gapi.client.init({
               clientId: CLIENT_ID,
               scope: SCOPE
             }).then(() => {
               gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
               updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
             });
           });
         }

         function updateSigninStatus(isSignedIn) {
           if (isSignedIn) {
             authToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;
             document.querySelector('.sign-in').style.display = 'none';
             loadDebts();
           } else {
             document.querySelector('.sign-in').style.display = 'inline-block';
           }
         }

         function handleAuthClick() {
           gapi.auth2.getAuthInstance().signIn();
         }

         async function loadDebts() {
           try {
             const response = await fetch(
               `https://sheets.googleapis.com/v4/spreadsheets/1f3R0FgbERWKPfxi3W9W_B-pocC9HYM_XX5byvVboPko/values/Sheet1!A2:D?key=${config.API_KEY}`
             );
             const data = await response.json();
             const debts = data.values || [];
             const table = document.getElementById('debtTable');
             table.innerHTML = '<tr><th>Who</th><th>Date</th><th>Amount</th><th>Status</th><th>Action</th></tr>';
             let total = 0;

             debts.forEach((debt, index) => {
               const [who, date, amount, status] = debt;
               const parsedAmount = parseFloat(amount) || 0;
               if (status.toLowerCase() === 'outstanding') total += parsedAmount;
               const row = table.insertRow();
               row.innerHTML = `
                 <td>${who}</td>
                 <td>${date}</td>
                 <td class="${parsedAmount > 50 && status.toLowerCase() === 'outstanding' ? 'overdue' : ''}">$${parsedAmount.toFixed(2)}</td>
                 <td class="${status.toLowerCase() === 'paid' ? 'paid' : 'overdue'}">${status}</td>
                 <td><button onclick="toggleStatus(${index + 2}, '${status}')">Toggle Status</button></td>
               `;
             });

             document.getElementById('total').textContent = total.toFixed(2);
           } catch (error) {
             console.error('Error fetching debts:', error);
             table.innerHTML = '<tr><td colspan="5">Error loading debts. Try again!</td></tr>';
           }
         }

         async function toggleStatus(row, currentStatus) {
           if (!authToken) {
             alert('Please sign in to update status.');
             return;
           }
           const newStatus = currentStatus.toLowerCase() === 'outstanding' ? 'Paid' : 'Outstanding';
           try {
             await gapi.client.load('sheets', 'v4', async () => {
               await gapi.client.sheets.spreadsheets.values.update({
                 spreadsheetId: '1f3R0FgbERWKPfxi3W9W_B-pocC9HYM_XX5byvVboPko',
                 range: `Sheet1!D${row}`,
                 valueInputOption: 'RAW',
                 resource: { values: [[newStatus]] }
               });
               loadDebts();
             });
           } catch (error) {
             console.error('Error updating status:', error);
             alert('Failed to update status. Try again.');
           }
         }

         initClient();
       </script>
     </body>
     </html>
